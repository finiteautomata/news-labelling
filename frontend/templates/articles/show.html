{% extends 'base.html' %}
{% load static %}
{% block  head %}

<link rel="stylesheet" href="{% static 'articles/articles.css' %}">

{% endblock %}

{% block title %}
{{article.title}}
{% endblock %}

{% block content %}


<h4> @{{article.user}} - {{article.title}}  </h4>



<p> {{article.created_at}} -- TwId: {{article.tweet_id}} </p>

<div class="row centering">
  <blockquote class="twitter-tweet"><p lang="es" dir="ltr"> {{article.text}} <a href="https://twitter.com/user/status/{{article.tweet_id}}?ref_src=twsrc%5Etfw">August 3, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

</div>

<h3> Noticia </h3>

<div class="wrap-collapsible">
  <input id="collapsible" class="toggle" type="checkbox">
  <label for="collapsible" class="lbl-toggle" tabindex="0">Mirar artículo</label>
  <div class="collapsible-content">
    <div class="content-inner">
      <p> {{article.body | linebreaks }} </p>
    </div>
  </div>

</div>


<h2> Comentarios </h2>

<div class="">
  <div class="row">
    <div class="one column">
      <b>Num</b>
    </div>
    <div class="six columns">
      <b>Comentario</b>
    </div>
    <div class="three columns">
      <b>¿Odio?</b>
    </div>
  </div>

  {% for comment in article.comment_set.all %}

    <div class="row" data-comment-id="{{comment.id}}">
      <div class="one column">
          {{ forloop.counter }}
      </div>
      <div class="six columns">
        <p>{{comment.text}}</p>
      </div>
    </div>

  {% endfor %}


</div>

<div class="row">
    <a href="#" id="not_interesting" class="button u-full-width" style="background-color:red; color:white">
      No es interesante
    </a>
</div>

<script type="text/javascript">
  let myLabels = document.querySelectorAll('.lbl-toggle');

  Array.from(myLabels).forEach(label => {
    label.addEventListener('keydown', e => {
      // 32 === spacebar
      // 13 === enter
      if (e.which === 32 || e.which === 13) {
        e.preventDefault();
        label.click();
      };
    });
  });


  axios.defaults.xsrfCookieName = 'csrftoken';
  axios.defaults.xsrfHeaderName = "X-CSRFTOKEN";
  var endpoint = "{% url 'api:article-label' article.id %}";
  document.getElementById("not_interesting").addEventListener("click", (event) => {
    event.preventDefault();

    axios.post(
      endpoint,
      { is_interesting: false }
    )
    .then( () => {
      alert("Artículo marcado como no interesante");
    })
    .catch( (errors) => {
      alert("Hubo un error con esto: "+ errors);
    });

  })
</script>

{% block actions %}

{% endblock %}

{%endblock %}
